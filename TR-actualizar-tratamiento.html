<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Administracion</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/boxicons/2.1.4/css/boxicons.min.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="css/nav.css" />
    <link rel="stylesheet" href="css/sidebar.css" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/tratamientos/actualizar-tratamiento.css" />

</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div style="display: flex; align-items: center;">
                    <span style="font-size: 20px; font-weight: 600; margin-left: 10px; color: #1a73e8;">ElderCare</span>
                </div>
            </div>
            <div class="sidebar-menu ">
                <div class="menu-item has-submenu" onclick="toggleSubmenu(this)">
                    <i class='bx bx-layer'></i>
                    <span>Inventario de Medicamentos</span>
                </div>
                <div class="submenu">
                    <a href="IN-ver-invetario.html" class="submenu-item"><span>Ver Inventario</span></a>
                    <a href="IN-registrar-medicamento.html" class="submenu-item"><span>Registrar Nuevo Medicamento</span></a>
                    <a href="IN-exportar.html" class="submenu-item"><span>Exportar Stock</span></a>
                </div>
                <div class="menu-item has-submenu" onclick="toggleSubmenu(this)">
                    <i class='bx bx-bar-chart'></i>
                    <span>Tratamientos Médicos</span>
                </div>
                <div class="submenu">
                    <a href="TR-tratamiento.html" class="submenu-item"><span>Tratamientos por Residente</span></a>
                    <a href="TR-actualizar-tratamiento.html" class="submenu-item"><span>Actualizar Tratamiento</span></a>
                    <a href="TR-historial-medicaciones.html" class="submenu-item"><span>Historial de Medicación</span></a>
                </div>
                <div class="menu-item has-submenu" onclick="toggleSubmenu(this)">
                    <i class='bx bx-bar-chart'></i>
                    <span>Informes</span>
                </div>
                <div class="submenu">
                    <a href="INFO-alertas-stock.html" class="submenu-item"><span>Alertas de stock Bajo</span></a>
                </div>
            </div>
        </div>
        <script>
            function toggleSubmenu(element) {
                const submenu = element.nextElementSibling;
                submenu.classList.toggle('expanded');
                element.classList.toggle('expanded');
            }
            function toggleSidebar() {
                document.getElementById('sidebar').classList.toggle('open');
                document.getElementById('overlay').classList.toggle('active');
            }
            // ... (resto de tu JS para el sidebar)
        </script>
        
        <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
        <div class="main-content">
            <div class="app-header">
                <div class="header-info-group">
                    <button class="sidebar-toggle-btn" onclick="toggleSidebar()">
                        <i class='bx bx-menu'></i>
                    </button>
                    <div class="page-title-nav"> Administracion</div>
                    <span class="role-badge-nav">Jefe Enfermeria</span>
                </div>
                <div class="header-action-list">
                    <form id="logout-form" action="" method="post" style="display:inline;">
                        <button type="submit" class="action-btn logout-btn" title="Cerrar sesión" aria-label="Cerrar sesión">
                            <i class='bx bx-log-out'></i>
                            <span>Cerrar sesión</span>
                        </button>
                    </form>
                </div>
            </div>
            
            <div class="content-area">
                <div class="update-treatment-view">
                    <h2 class="view-title"><i class='bx bx-user'></i>Tratamiento Médico</h2>
                    
                    <div class="treatment-form-area form-container" id="treatment-details-form">
                        <h3 class="section-title">
                            <i class='bx bx-detail'></i> Detalles del Tratamiento para:
                            <span id="selected-resident-name" class="highlighted-resident-name">Ana García López (Habitacion: 101A)</span>
                        </h3>
                        
                        <form id="update-treatment-form" action="/ruta/para/actualizar/tratamiento" method="POST">
                            <div class="form-grid general-info-grid">
                                <div class="form-group">
                                    <label for="treatment-diagnosis"><i class='bx bx-first-aid'></i> Diagnóstico(s) Principal(es)</label>
                                    <input type="text" id="treatment-diagnosis" name="diagnostico" class="form-input" value="Hipertensión Arterial, Diabetes Mellitus Tipo 2" placeholder="Diagnósticos separados por coma">
                                </div>
                                <div class="form-group form-group-full">
                                    <label for="treatment-notes"><i class='bx bx-note'></i> Notas Generales del Tratamiento</label>
                                    <textarea id="treatment-notes" name="notas" class="form-textarea" rows="3" placeholder="Indicaciones especiales, observaciones, etc.">Paciente responde bien al tratamiento actual. Vigilar niveles de glucosa post-prandial.</textarea>
                                </div>
                            </div>
                            
                            <div class="medication-list-section">
                                <h4 class="sub-section-title"><i class='bx bxs-capsule'></i> Medicamentos</h4>
                                <div class="table-container">
                                    <table class="data-table medication-edit-table">
                                        <thead>
                                            <tr>
                                                <th><i class='bx bx-rename'></i> Medicamento</th>
                                                <th><i class='bx bx-ruler'></i> Dosis</th>
                                                <th><i class='bx bx-calendar-check'></i> Frecuencia</th>
                                                <th><i class='bx bx-injection'></i> Vía</th>
                                                <th><i class='bx bx-calendar-plus'></i> Inicio</th>
                                                <th><i class='bx bx-calendar-minus'></i> Fin</th>
                                                <th><i class='bx bx-trash'></i> Quitar</th>
                                            </tr>
                                        </thead>
                                        <tbody id="medication-list-body">
                                            <tr>
                                                <input type="hidden" name="med_id[]" value="med_abc">
                                                <td>
                                                    <input type="text" name="med_nombre[]" class="form-input" value="Paracetamol 500mg" placeholder="Nombre">
                                                </td>
                                                <td class="dosis-cell">
                                                    <input type="number" name="med_dosis_cantidad[]" class="form-input-num" value="1" min="0" step="1">
                                                    <select name="med_dosis_unidad[]" class="form-select-unit">
                                                        <option value="comp" selected>comp</option>
                                                        <option value="mg">mg</option>
                                                        <option value="ml">ml</option>
                                                        <option value="gotas">gotas</option>
                                                        <option value="UI">UI</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select name="med_frecuencia[]" class="form-select">
                                                        <option value="prn" selected>Si es necesario</option>
                                                        <option value="24">Cada 24 horas</option>
                                                        <option value="12">Cada 12 horas</option>
                                                        <option value="8">Cada 8 horas</option>
                                                        <option value="6">Cada 6 horas</option>
                                                        <option value="unica">Dosis Única</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select name="med_via[]" class="form-select">
                                                        <option value="oral" selected>Oral</option>
                                                        <option value="topica">Tópica</option>
                                                        <option value="intravenosa">Intravenosa</option>
                                                    </select>
                                                </td>
                                                <td><input type="date" name="med_inicio[]" class="form-input" value="2024-01-10"></td>
                                                <td><input type="date" name="med_fin[]" class="form-input" value=""></td>
                                                <td><button type="button" class="btn-icon btn-remove-med" title="Quitar medicamento"><i class='bx bx-trash'></i></button></td>
                                            </tr>
                                            <tr>
                                                <input type="hidden" name="med_id[]" value="med_xyz">
                                                <td>
                                                    <input type="text" name="med_nombre[]" class="form-input" value="Losartán 50mg" placeholder="Nombre">
                                                </td>
                                                <td class="dosis-cell">
                                                    <input type="number" name="med_dosis_cantidad[]" class="form-input-num" value="1" min="0" step="1">
                                                    <select name="med_dosis_unidad[]" class="form-select-unit">
                                                        <option value="comp" selected>comp</option>
                                                        <option value="mg">mg</option>
                                                        <option value="ml">ml</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select name="med_frecuencia[]" class="form-select">
                                                        <option value="prn">Si es necesario</option>
                                                        <option value="24" selected>Cada 24 horas</option>
                                                        <option value="12">Cada 12 horas</option>
                                                        <option value="8">Cada 8 horas</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <select name="med_via[]" class="form-select">
                                                        <option value="oral" selected>Oral</option>
                                                        <option value="topica">Tópica</option>
                                                    </select>
                                                </td>
                                                <td><input type="date" name="med_inicio[]" class="form-input" value="2023-11-01"></td>
                                                <td><input type="date" name="med_fin[]" class="form-input" value=""></td>
                                                <td><button type="button" class="btn-icon btn-remove-med" title="Quitar medicamento"><i class='bx bx-trash'></i></button></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <button type="button" class="btn btn-secondary btn-add-med" id="add-med-button"><i class='bx bx-plus-medical'></i> Añadir Medicamento</button>
                            </div>
                            
                            <div class="form-actions">
                                <a href="/ruta/a/vista/anterior" class="btn btn-secondary"><i class='bx bx-arrow-back'></i> Volver</a>
                                <button type="submit" class="btn btn-primary"><i class='bx bx-save'></i> Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <script>
                    const medicationListBody = document.getElementById('medication-list-body');
                    const addMedButton = document.getElementById('add-med-button');
                
                    addMedButton.addEventListener('click', () => {
                        addEmptyMedicationRow();
                    });
                
                    medicationListBody.addEventListener('click', (event) => {
                        const removeButton = event.target.closest('.btn-remove-med');
                        if (removeButton) {
                            removeMedicationRow(removeButton.closest('tr'));
                        }
                    });
                
                    function addEmptyMedicationRow() {
                        const newRow = createMedicationRow();
                        medicationListBody.appendChild(newRow);
                    }

                    // ====== FUNCIÓN JAVASCRIPT MODIFICADA ======
                    function createMedicationRow() {
                        const tr = document.createElement('tr');
                        // Se usa innerHTML para crear la estructura completa de la nueva fila
                        tr.innerHTML = `
                            <td>
                                <input type="text" name="med_nombre[]" class="form-input" placeholder="Nombre">
                            </td>
                            <td class="dosis-cell">
                                <input type="number" name="med_dosis_cantidad[]" class="form-input-num" value="1" min="0" step="1">
                                <select name="med_dosis_unidad[]" class="form-select-unit">
                                    <option value="comp">comp</option>
                                    <option value="mg">mg</option>
                                    <option value="ml">ml</option>
                                    <option value="gotas">gotas</option>
                                    <option value="UI">UI</option>
                                </select>
                            </td>
                            <td>
                                <select name="med_frecuencia[]" class="form-select">
                                    <option value="" disabled selected>Seleccione</option>
                                    <option value="prn">Si es necesario</option>
                                    <option value="24">Cada 24 horas</option>
                                    <option value="12">Cada 12 horas</option>
                                    <option value="8">Cada 8 horas</option>
                                    <option value="6">Cada 6 horas</option>
                                    <option value="unica">Dosis Única</option>
                                </select>
                            </td>
                            <td>
                                <select name="med_via[]" class="form-select">
                                    <option value="" disabled selected>Seleccione</option>
                                    <option value="oral">Oral</option>
                                    <option value="topica">Tópica</option>
                                    <option value="intravenosa">Intravenosa</option>
                                    <option value="subcutanea">Subcutánea</option>
                                    <option value="inhalada">Inhalada</option>
                                </select>
                            </td>
                            <td><input type="date" name="med_inicio[]" class="form-input"></td>
                            <td><input type="date" name="med_fin[]" class="form-input"></td>
                            <td>
                                <button type="button" class="btn-icon btn-remove-med" title="Quitar medicamento">
                                    <i class='bx bx-trash'></i>
                                </button>
                            </td>
                        `;
                        return tr;
                    }
                    // ===========================================
                
                    function removeMedicationRow(rowElement) {

                        rowElement.remove();
                    }
                </script>
            </div>
        </div>
    </div>
</body>
</html>